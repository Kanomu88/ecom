<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö - Doll Pre-Order</title>
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/login.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/footer.css">
  <link rel="icon" type="image/x-icon" href="../img/logo.png">
</head>

<body>
  <header class="header">
    <nav class="navbar">
      <div class="nav-left">
        <a href="../pages/search.html" class="search-link">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
        <a href="../pages/index.html" class="nav-item home">Home</a>
      </div>
      <div class="nav-center">
        <a href="../pages/index.html">
          <img src="../img/logo.png" alt="Doll Pre-Order Logo">
        </a>
      </div>
      <div class="nav-right">
        <a href="../pages/cart.html" class="nav-item cart-link">
          üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
          <span id="cart-badge" class="cart-badge">0</span>
        </a>
        <a href="../pages/team.html" class="nav-item">About Us</a>
        <a href="../pages/login.html" class="login-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
      </div>
    </nav>
  </header>

  <main>
    <div class="login-container">
      <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <form id="login-form">
        <div class="form-group">
          <label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
          <input type="text" id="username" name="username" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
        </div>
        <div class="form-group">
          <label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input type="password" id="password" name="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
        </div>
        <button type="submit" class="login-btn-submit">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      </form>
      <a href="index.html" class="back-link">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    </div>
  </main>

  <footer
    style="background: var(--primary-pink); padding: 30px 20px; text-align: center; color: var(--text-color); margin-top: 60px;">
    <p>&copy; 2024 Doll Pre-Order. All rights reserved.</p>
    <p>Made with ‚ù§Ô∏è by Our Team</p>
  </footer>

</body>

</html>

<script>
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ login ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
  if (localStorage.getItem('token')) {
    window.location.href = 'admin-products.html';
  }

  // ‡∏à‡∏±‡∏ö event submit form
  document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    try {
      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API Login
      const response = await fetch('http://localhost:3000/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();

      if (data.success) {
        // ‡πÄ‡∏Å‡πá‡∏ö token ‡πÅ‡∏•‡∏∞ user ‡πÉ‡∏ô localStorage
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        alert('Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');

        // redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ admin
        window.location.href = 'admin-products.html';
      } else {
        // ‡πÅ‡∏™‡∏î‡∏á error
        alert(data.message || 'Login ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
    }
  });
</script>

</body>

</html>