<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - Doll Pre-Order</title>
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/search.css">
  <link rel="stylesheet" href="../css/footer.css">
  <link rel="icon" type="image/x-icon" href="../img/logo.png">
</head>

<body>
  <header class="header">
    <nav class="navbar">
      <div class="nav-left">
        <a href="../pages/search.html" class="search-link">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
        <a href="../pages/index.html" class="nav-item home">Home</a>
      </div>
      <div class="nav-center">
        <a href="../pages/index.html">
          <img src="../img/logo.png" alt="Doll Pre-Order Logo">
        </a>
      </div>
      <div class="nav-right">
        <a href="../pages/cart.html" class="nav-item cart-link">
          üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
          <span id="cart-badge" class="cart-badge">0</span>
        </a>
        <a href="../pages/team.html" class="nav-item">About Us</a>
        <a href="../pages/login.html" class="login-btn" id="auth-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
      </div>
    </nav>
  </header>

  <main class="search-container">
    <div class="search-form">
      <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
      <form id="search-form">
        <div class="form-row">
          <div class="form-group">
            <label for="search-name">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
            <input type="text" id="search-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô Bunny, Bear">
          </div>
          <div class="form-group">
            <label for="search-brand">‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</label>
            <select id="search-brand">
              <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
              <option value="Jellycat">Jellycat</option>
              <option value="Care Bear">Care Bear</option>
              <option value="Steiff">Steiff</option>
              <option value="Gund">Gund</option>
              <option value="Squishmallows">Squishmallows</option>
            </select>
          </div>
          <div class="form-group">
            <label for="search-rating">‡πÄ‡∏£‡∏ï‡∏ï‡∏¥‡πâ‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</label>
            <select id="search-rating">
              <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
              <option value="5">5 ‡∏î‡∏≤‡∏ß</option>
              <option value="4.5">4.5 ‡∏î‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</option>
              <option value="4">4 ‡∏î‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</option>
            </select>
          </div>
        </div>
        <div class="search-btn-container">
          <button type="submit" class="search-btn">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        </div>
      </form>
    </div>

    <div class="results-container">
      <div class="results-header">
        <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
        <span id="result-count">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
      </div>
      <div id="results-grid" class="product-grid"></div>
    </div>
  </main>

  <footer>
    <p>&copy; 2024 Doll Pre-Order. All rights reserved.</p>
    <p>Made with ‚ù§Ô∏è by Our Team</p>
  </footer>

  <script>
    // Check Login Status
    function checkLoginStatus() {
      const token = localStorage.getItem('token');
      const authBtn = document.getElementById('auth-btn');
      if (token) {
        authBtn.textContent = '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö';
        authBtn.href = '#';
        authBtn.onclick = (e) => {
          e.preventDefault();
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.reload();
        };
      }
    }
    checkLoginStatus();

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    async function loadAllProducts() {
      try {
        const response = await fetch('http://localhost:3000/api/public/products');
        const data = await response.json();

        if (data.success) {
          displayResults(data.data);
        }
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('results-grid').innerHTML = '<p style="text-align:center; color: var(--text-secondary);">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    document.getElementById('search-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('search-name').value;
      const brand = document.getElementById('search-brand').value;
      const rating = document.getElementById('search-rating').value;

      const params = new URLSearchParams();
      if (name) params.append('name', name);
      if (brand) params.append('brand', brand);
      if (rating) params.append('rating', rating);

      try {
        const response = await fetch(`http://localhost:3000/api/public/products?${params}`);
        const data = await response.json();

        if (data.success) {
          displayResults(data.data);
        }
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('results-grid').innerHTML = '<p style="text-align:center; color: var(--text-secondary);">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>';
      }
    });

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    function displayResults(products) {
      const grid = document.getElementById('results-grid');
      const count = document.getElementById('result-count');

      count.textContent = `${products.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

      if (products.length === 0) {
        grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>';
        return;
      }

      grid.innerHTML = products.map(p => `
            <article class="product-card">
              <figure class="product-image-container">
                <img src="${p.imageUrl || 'https://placehold.co/400x500/FFE5EC/8B6B7B?text=' + encodeURIComponent(p.name)}" 
                     alt="${p.name}" 
                     onerror="this.src='https://placehold.co/400x500/FFE5EC/8B6B7B?text=${encodeURIComponent(p.name)}'">
              </figure>
              <h3>${p.name}</h3>
              <p class="brand">${p.brand}</p>
              <div class="stars">
                <span>${'‚òÖ'.repeat(Math.floor(p.rating))}${'‚òÜ'.repeat(5 - Math.floor(p.rating))}</span>
              </div>
              <span class="rating-text">‚≠ê ${p.rating}</span>
              <p class="price">‡∏ø ${p.price.toLocaleString()}</p>
              <a href="product-detail.html?id=${p._id}" class="details-btn">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
            </article>
          `).join('');
    }

    loadAllProducts();
  </script>

  <script src="../js/cart-utils.js"></script>
</body>

</html>