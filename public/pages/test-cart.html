<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ - Debug</title>
    <link rel="stylesheet" href="../css/common.css">
    <style>
        .debug-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .debug-section h2 {
            color: var(--accent-pink);
            margin-bottom: 15px;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .btn-primary {
            background: var(--accent-pink);
            color: white;
        }
        .btn-danger {
            background: #f44336;
            color: white;
        }
        .btn-success {
            background: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-left">
                <a href="index.html" class="nav-item home">Home</a>
            </div>
            <div class="nav-center">
                <a href="index.html">
                    <img src="../img/logo.png" alt="PINKORY Logo">
                </a>
            </div>
            <div class="nav-right">
                <a href="cart.html" class="nav-item">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</a>
            </div>
        </nav>
    </header>

    <main class="debug-container">
        <h1>üîß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞ Debug ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

        <div class="debug-section">
            <h2>üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</h2>
            <pre id="cart-data">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</pre>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="refreshCart()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                <button class="btn btn-danger" onclick="clearCartDebug()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            </div>
        </div>

        <div class="debug-section">
            <h2>‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
            <div id="validation-result"></div>
        </div>

        <div class="debug-section">
            <h2>üß™ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
            <p>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡πÉ‡∏ä‡πâ productId ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</p>
            <input type="text" id="test-product-id" placeholder="Product ID (‡πÄ‡∏ä‡πà‡∏ô 691e21e4129b8f8e4ce30e0d)" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;">
            <div class="btn-group">
                <button class="btn btn-success" onclick="addTestProduct()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
            </div>
        </div>

        <div class="debug-section">
            <h2>üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
            <div class="btn-group">
                <a href="search.html" class="btn btn-primary">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
                <a href="cart.html" class="btn btn-primary">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</a>
                <a href="checkout.html" class="btn btn-success">‡πÑ‡∏õ‡∏ó‡∏µ‡πà Checkout</a>
            </div>
        </div>
    </main>

    <script src="../js/cart-utils.js"></script>
    <script>
        function refreshCart() {
            const cart = getCart();
            document.getElementById('cart-data').textContent = JSON.stringify(cart, null, 2);
            validateCart();
        }

        function validateCart() {
            const cart = getCart();
            const result = document.getElementById('validation-result');
            
            if (cart.length === 0) {
                result.innerHTML = '<p style="color: orange;">‚ö†Ô∏è ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>';
                return;
            }

            let html = '<ul style="list-style: none; padding: 0;">';
            let hasError = false;

            cart.forEach((item, index) => {
                const errors = [];
                
                if (!item.productId && !item.id && !item._id) {
                    errors.push('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ productId');
                    hasError = true;
                }
                if (!item.name) errors.push('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                if (!item.price || isNaN(item.price)) errors.push('‚ùå ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                if (!item.quantity || isNaN(item.quantity)) errors.push('‚ùå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');

                const status = errors.length === 0 ? '‚úÖ' : '‚ùå';
                html += `<li style="margin: 10px 0; padding: 10px; background: ${errors.length === 0 ? '#e8f5e9' : '#ffebee'}; border-radius: 8px;">
                    <strong>${status} ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ #${index + 1}: ${item.name || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠'}</strong><br>
                    ProductID: ${item.productId || item.id || item._id || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}<br>
                    Price: ${item.price}<br>
                    Quantity: ${item.quantity}<br>
                    ${errors.length > 0 ? '<span style="color: red;">' + errors.join(', ') + '</span>' : ''}
                </li>`;
            });

            html += '</ul>';

            if (hasError) {
                html = '<p style="color: red; font-weight: bold;">‚ö†Ô∏è ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</p>' + html;
            } else {
                html = '<p style="color: green; font-weight: bold;">‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>' + html;
            }

            result.innerHTML = html;
        }

        function clearCartDebug() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                clearCart();
                refreshCart();
                alert('‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            }
        }

        async function addTestProduct() {
            const productId = document.getElementById('test-product-id').value.trim();
            
            if (!productId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Product ID');
                return;
            }

            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å API
                const response = await fetch(`http://localhost:3000/api/public/products/${productId}`);
                const data = await response.json();

                if (data.success && data.data) {
                    const product = data.data;
                    const cartItem = {
                        productId: product._id,
                        name: product.name,
                        price: product.price,
                        quantity: 1,
                        imageUrl: product.imageUrl || '',
                        brand: product.brand || ''
                    };

                    addToCart(cartItem);
                    alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + product.name);
                    refreshCart();
                } else {
                    alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        refreshCart();
    </script>
</body>
</html>
