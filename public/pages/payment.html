<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô - Doll Pre-Order</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/checkout.css">
    <link rel="stylesheet" href="../css/payment.css">
    <link rel="icon" type="image/x-icon" href="../img/logo.png">
</head>
<body>
    <header class="header" id="header">
        <nav class="navbar">
            <div class="nav-left">
                <a href="search.html" class="search-link">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</a>
                <a href="index.html" class="nav-item">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
            </div>
            <div class="nav-center">
                <a href="index.html">
                    <img src="../img/logo.png" alt="Doll Pre-Order Logo">
                </a>
            </div>
            <div class="nav-right">
                <a href="cart.html" class="cart-link">
                    üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    <span id="cart-badge" class="cart-badge">0</span>
                </a>
                <a href="team.html" class="nav-item">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
                <a href="login.html" class="login-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
            </div>
        </nav>
    </header>

    <main class="payment-container">
        <div class="checkout-header">
            <h1>üí≥ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h1>
            <div class="step-indicator">
                <div class="step completed">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</div>
                <div class="step active">2. ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
                <div class="step">3. ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
            </div>
        </div>

        <div class="payment-box">
            <h2>üí≥ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô PromptPay</h2>
            
            <!-- Left Side: QR Code -->
            <div class="payment-left">
                <div class="qr-code-container">
                    <h3>üì± ‡∏™‡πÅ‡∏Å‡∏ô QR Code</h3>
                    <img id="qr-code" class="qr-code" src="" alt="QR Code">
                </div>
                
                <div class="order-info">
                    <div class="order-info-row">
                        <span>üì¶ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</span>
                        <span id="order-number" style="font-weight: 600;">-</span>
                    </div>
                    <div class="order-info-row total">
                        <span>üí∞ ‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞:</span>
                        <span id="order-amount">‡∏ø0</span>
                    </div>
                </div>
            </div>

            <!-- Right Side: Instructions -->
            <div class="payment-right">
                <div class="instructions">
                    <h4>üì± ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h4>
                    <ol>
                        <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</li>
                        <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π "‡∏™‡πÅ‡∏Å‡∏ô QR"</li>
                        <li>‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢</li>
                        <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</li>
                        <li>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</li>
                    </ol>
                </div>
                
                <div class="timer-warning">
                    <span>‚è±Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</span>
                    <span class="timer" id="timer">15:00</span>
                </div>

                <button onclick="confirmPayment()" class="confirm-btn">
                    ‚úì ‡∏â‡∏±‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                </button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2024 PINKORY. All rights reserved.</p>
    </footer>

    <script src="../js/cart-utils.js"></script>
    <script>
        // Get order from sessionStorage
        const orderData = JSON.parse(sessionStorage.getItem('currentOrder') || '{}');
        
        if (!orderData.orderNumber) {
            alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
            window.location.href = 'cart.html';
        }
        
        // Display order info
        document.getElementById('order-number').textContent = orderData.orderNumber;
        document.getElementById('order-amount').textContent = `‡∏ø${orderData.totalAmount?.toLocaleString() || '0'}`;
        
        // Display QR Code
        if (orderData.qrCode) {
            document.getElementById('qr-code').src = orderData.qrCode;
        } else {
            document.querySelector('.qr-code-container').innerHTML = '<p style="color: #F44336;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÑ‡∏î‡πâ</p>';
        }
        
        // Countdown timer
        let timeLeft = 15 * 60; // 15 minutes in seconds
        const timerElement = document.getElementById('timer');
        
        const countdown = setInterval(() => {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                clearInterval(countdown);
                alert('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                window.location.href = 'cart.html';
            }
            
            // Change color when time is running out
            if (timeLeft <= 60) {
                timerElement.style.color = '#F44336';
                timerElement.style.animation = 'pulse 1s infinite';
            }
        }, 1000);
        
        function confirmPayment() {
            if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                clearInterval(countdown);
                // Save order info for tracking
                sessionStorage.setItem('completedOrder', JSON.stringify(orderData));
                window.location.href = 'order-success.html';
            }
        }
    </script>
</body>
</html>
